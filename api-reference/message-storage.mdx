---
title: "Gestão de Mensagens"
icon: "database"
description: "Entenda como funciona o armazenamento, limites e consumo de mensagens."
---

A **ZapUnlocked-API** armazena automaticamente as mensagens recebidas para permitir buscas e análises. Este sistema é otimizado para economizar espaço usando **compressão JSON**.

## <Icon icon="clock" iconType="sharp-regular" color="#9d4fe6" size={22} /> Quando as Mensagens São Salvas

As mensagens **só começam a ser armazenadas quando a API está conectada e rodando**. Mensagens enviadas enquanto o bot está offline não são recuperadas retroativamente.

<Note>
  O armazenamento é incremental: cada nova mensagem recebida é adicionada ao histórico do contato correspondente.
</Note>

---

## <Icon icon="list-ol" iconType="sharp-regular" color="#9d4fe6" size={22} /> Limites de Armazenamento

Para manter o sistema leve e eficiente, aplicamos os seguintes limites:

| Tipo | Limite |
| :--- | :--- |
| **Mensagens por Chat** | 100 últimas mensagens |
| **Contatos Recentes** | 1.000 contatos com interação |

<Warning>
  Quando o limite é atingido, as mensagens ou contatos mais antigos são automaticamente removidos para dar espaço aos novos.
</Warning>

---

## <Icon icon="file-zipper" iconType="sharp-regular" color="#9d4fe6" size={22} /> Compressão e Economia de Espaço

Todos os arquivos JSON de mensagens são **compactados com gzip** antes de serem salvos no disco. Isso reduz drasticamente o consumo de armazenamento.

### Processo
1. **Recebimento**: Mensagem chega via WhatsApp.
2. **Indexação**: Dados são estruturados em JSON.
3. **Compressão**: JSON é compactado (gzip).
4. **Armazenamento**: Arquivo compactado é salvo no disco.
5. **Leitura**: Ao buscar, o arquivo é descompactado em memória e retornado.

---

## <Icon icon="calculator" iconType="sharp-regular" color="#9d4fe6" size={22} /> Consumo Aproximado de Armazenamento

Baseado em testes reais, cada mensagem ocupa aproximadamente **0.4 KB** após compressão. Veja alguns exemplos:

| Quantidade de Mensagens | Espaço Ocupado (Aproximado) |
| :--- | :--- |
| 1 mensagem | ~0.4 KB |
| 5 mensagens | ~0.75 KB |
| 10 mensagens | ~1.06 KB |
| 50 mensagens | ~4.5 KB |
| 100 mensagens | ~8 KB |
| 1.000 mensagens (10 chats) | ~80 KB |
| 10.000 mensagens (100 chats) | ~800 KB |

<Tip>
  Com o limite de **100 mensagens por chat** e **1.000 contatos**, o consumo máximo teórico é de aproximadamente **80 MB** de armazenamento para mensagens.
</Tip>

---

## <Icon icon="broom" iconType="sharp-regular" color="#9d4fe6" size={22} /> Limpeza de Dados

Se você precisar liberar espaço ou resetar o histórico, use o endpoint:  
[`DELETE /management/cleanup`](/api-reference/endpoint/cleanup).

<Warning>
  Esta ação é **irreversível** e apaga todos os JSONs de mensagens e índices de contatos. A sessão do WhatsApp não é desconectada.
</Warning>
