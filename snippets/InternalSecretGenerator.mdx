
export const InternalSecretGenerator = () => {
  if (typeof window === 'undefined') return null;

  const placeholders = ['SEU_INTERNAL_SECRET', 'YOUR_INTERNAL_SECRET'];

  const generateKey = () => {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let k = '';
    for (let i = 0; i < 35; i++) {
        if (i > 0 && i % 5 === 0) k += '-';
        k += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return k;
  };

  const sync = () => {
    const savedKey = localStorage.getItem('zap_unlocked_internal_secret');
    if (!savedKey) return;
    
    document.querySelectorAll('code, pre span, .terminal, a, span.token').forEach(el => {
      if (el.children.length === 0 && el.textContent) {
        placeholders.forEach(p => {
          if (el.textContent.includes(p)) el.textContent = el.textContent.replaceAll(p, savedKey);
        });
      }
    });

    const display = document.getElementById('internal-secret-display');
    if (display) display.innerText = savedKey || '';
  };

  if (typeof React !== 'undefined') {
    React.useEffect(() => {
      if (!localStorage.getItem('zap_unlocked_internal_secret')) {
        const k = generateKey();
        localStorage.setItem('zap_unlocked_internal_secret', k);
      }
      const t1 = setTimeout(sync, 500);
      const t2 = setTimeout(sync, 1500);
      window.addEventListener('internal_secret_updated', sync);
      return () => {
        clearTimeout(t1); clearTimeout(t2);
        window.removeEventListener('internal_secret_updated', sync);
      };
    }, []);
  }

  const initial = typeof window !== 'undefined' ? localStorage.getItem('zap_unlocked_internal_secret') : null;

  return (
    <div className="flex items-center gap-2 flex-nowrap inline-flex align-middle py-1">
      <code 
        id="internal-secret-display" 
        className="text-primary font-bold text-[13px] whitespace-nowrap min-w-[290px] text-center !border-none !ring-0 !outline-none bg-primary/5 px-2 py-0.5 rounded"
        style={{ border: 'none', boxShadow: 'none', outline: 'none' }}
      >
        {initial || "Gerando..."}
      </code>
    </div>
  );
}
